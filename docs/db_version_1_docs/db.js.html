<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: db.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: db.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Database V1 - No users
const fs = require('fs');
const PouchDB = require('pouchdb')
PouchDB.plugin(require('pouchdb-find'))
const DB_PATH = './nodejs_introdb'

const DEFAULT_STATE = [{
    '_id': '1e01ba13-ea47-4d24-9131-d95c23d1bb8f',
    'done': false,
    'value': 'Learn React'
  },{
    '_id': '076e0daf-e4ee-42af-8c3d-f6210920b0b7',
    'done': true,
    'value': 'Rake the yard'
  },{
    '_id': '5516fdbb-046a-4a4a-9085-36086b5ef00a',
    'done': false,
    'value': 'Buy milk'
  },{
    '_id': '385f6953-9658-4b3d-a791-afcd9460cb2b',
    'done': false,
    'value': 'Buy eggs'
  },{
    '_id': 'e8f3921b-157c-4ac5-b54c-24485048a9c1',
    'done': true,
    'value': 'Prepare next trip to south'
  }
]

let db

if (!fs.existsSync(DB_PATH)) {
  // Initialize DB
  db = new PouchDB(DB_PATH)
  console.log("[db.js] First time, initialize database with example data...")
  db.bulkDocs(DEFAULT_STATE).then(result => console.log(result))
} else {
  db = new PouchDB(DB_PATH)
}


/**
 * Fetch all tasks from database
 * @return     {Task[]}    Promise of array of tasks
 */
function allTasks() {
  // Return all tasks
  return db.allDocs({
    include_docs: true
  }).then(r => r.rows)
  .then(r => r.map(d => d.doc))
  .then(r => r.map(d => ({id: d._id, done: d.done, value: d.value})))
}

/**
 * Create Task into database
 * @param      {string}   id Tasks id
 * @param      {string}   value Tasks content
 * @param      {boolean}  done Flag if task is done/undone
 * @return     {Task} Promise of the just created task
 */
function createTask(id, value, done) {
  return db.put({_id: id, value: value, done: done})
  .then(r => ({id, value, done}))
}

/**
 * Delete Task from database by id
 * @param      {string}   id
 * @return     {string} Promise of the deleted id
 */
function deleteTask(id) {
  return db.get(id)
  .then(doc => db.remove(doc))
  .then(result => id)
}

/**
 * Update Task from database
 * @param      {string}   id Tasks id
 * @param      {string}   value Tasks content
 * @param      {boolean}  done Flag if task is done/undone
 * @return     {Task} Promise of the just created task
 */
function updateTask(id, value, done) {
  return createTask(id, value, done)
}

module.exports = {
  allTasks,
  createTask,
  deleteTask,
  updateTask
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#allTasks">allTasks</a></li><li><a href="global.html#createTask">createTask</a></li><li><a href="global.html#deleteTask">deleteTask</a></li><li><a href="global.html#updateTask">updateTask</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri May 12 2017 01:32:12 GMT+0300 (EEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
